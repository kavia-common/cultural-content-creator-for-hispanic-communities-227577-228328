{"is_source_file": true, "format": "JavaScript", "description": "This source file provides a frontend-only service for generating captions using OpenAI APIs, specifically for social media content targeting the Hispanic community. It includes functions for managing API keys, building prompts, calling the OpenAI API, and processing the generated JSON captions.", "external_files": ["fetch API (built-in in browsers)"], "external_methods": ["fetch"], "published": ["setOpenAIKeyForSession", "getOpenAIKeySource", "getEffectiveOpenAIKey", "buildCaptionPrompt", "generateCaptions", "CaptionVariationType"], "classes": [], "methods": [{"name": "setOpenAIKeyForSession(apiKey)", "description": "Sets a temporary OpenAI API key in memory for this browser session only.", "scope": "", "scopeKind": ""}, {"name": "getOpenAIKeySource()", "description": "Returns where the OpenAI key is coming from (environment variable, memory, or none).", "scope": "", "scopeKind": ""}, {"name": "getEffectiveOpenAIKey()", "description": "Returns the effective OpenAI API key, prioritizing environment variable over in-memory key.", "scope": "", "scopeKind": ""}, {"name": "buildCaptionPrompt({ topic, niche, emotion, language })", "description": "Builds a JSON prompt string to instruct the API to generate three caption variations suitable for social media, respecting language and cultural considerations.", "scope": "", "scopeKind": ""}, {"name": "generateCaptions({ topic, niche, emotion, language })", "description": "Calls the OpenAI API to generate captions based on provided topic, niche, emotion, and language, handling JSON parsing and errors.", "scope": "", "scopeKind": ""}, {"name": "callOpenAIChatCompletions({ apiKey, prompt })", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "extractTextFromChatCompletionPayload(payload)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "mapExceptionToKey(err)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "mapHttpErrorToKey(status)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "normalizeCaptionsResult({ raw, language, emotion })", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "normalizeLanguage(lang)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "normalizeVariationType(v)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "safeJsonParse(text)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "truncate(str, max)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["fetch", "callOpenAIChatCompletions", "extractTextFromChatCompletionPayload"], "search-terms": ["openaiCaptions", "generateCaptions", "buildCaptionPrompt", "setOpenAIKeyForSession", "frontend-only"], "state": 2, "file_id": 30, "knowledge_revision": 70, "git_revision": "99a0e67c42de75a9e1bf3e2c18131c85da8ee23b", "ctags": [{"_type": "tag", "name": "CaptionVariationType", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^export const CaptionVariationType = VariationType;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "buildCaptionPrompt", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^export function buildCaptionPrompt({ topic, niche, emotion, language }) {$/", "language": "JavaScript", "kind": "function", "signature": "({ topic, niche, emotion, language })"}, {"_type": "tag", "name": "callOpenAIChatCompletions", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^async function callOpenAIChatCompletions({ apiKey, prompt }) {$/", "language": "JavaScript", "kind": "function", "signature": "({ apiKey, prompt })"}, {"_type": "tag", "name": "extractTextFromChatCompletionPayload", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^function extractTextFromChatCompletionPayload(payload) {$/", "language": "JavaScript", "kind": "function", "signature": "(payload)"}, {"_type": "tag", "name": "generateCaptions", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^export async function generateCaptions({ topic, niche, emotion, language }) {$/", "language": "JavaScript", "kind": "function", "signature": "({ topic, niche, emotion, language })"}, {"_type": "tag", "name": "getEffectiveOpenAIKey", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^export function getEffectiveOpenAIKey() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "getOpenAIKeySource", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^export function getOpenAIKeySource() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "inMemoryApiKey", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^let inMemoryApiKey = '';$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "mapExceptionToKey", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^function mapExceptionToKey(err) {$/", "language": "JavaScript", "kind": "function", "signature": "(err)"}, {"_type": "tag", "name": "mapHttpErrorToKey", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^function mapHttpErrorToKey(status) {$/", "language": "JavaScript", "kind": "function", "signature": "(status)"}, {"_type": "tag", "name": "normalizeCaptionsResult", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^function normalizeCaptionsResult({ raw, language, emotion }) {$/", "language": "JavaScript", "kind": "function", "signature": "({ raw, language, emotion })"}, {"_type": "tag", "name": "normalizeLanguage", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^function normalizeLanguage(lang) {$/", "language": "JavaScript", "kind": "function", "signature": "(lang)"}, {"_type": "tag", "name": "normalizeVariationType", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^function normalizeVariationType(v) {$/", "language": "JavaScript", "kind": "function", "signature": "(v)"}, {"_type": "tag", "name": "safeJsonParse", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^function safeJsonParse(text) {$/", "language": "JavaScript", "kind": "function", "signature": "(text)"}, {"_type": "tag", "name": "setOpenAIKeyForSession", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^export function setOpenAIKeyForSession(apiKey) {$/", "language": "JavaScript", "kind": "function", "signature": "(apiKey)"}, {"_type": "tag", "name": "truncate", "path": "/home/kavia/workspace/code-generation/cultural-content-creator-for-hispanic-communities-227577-228328/content_strategy_frontend/src/services/openaiCaptions.js", "pattern": "/^function truncate(str, max) {$/", "language": "JavaScript", "kind": "function", "signature": "(str, max)"}], "hash": "43258621476a19041cf93f1520caf260", "format-version": 4, "code-base-name": "content_strategy_frontend", "filename": "content_strategy_frontend/src/services/openaiCaptions.js", "fields": [{"name": "let inMemoryApiKey = '';", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"70": "99a0e67c42de75a9e1bf3e2c18131c85da8ee23b"}]}